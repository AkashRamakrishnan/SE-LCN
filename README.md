# SE-LCN

This is the code repository for the paper titled 'Symmetry Enhanced Skin Lesion Classification Network: A Cascaded MultiTask Learning Approach (SE-LCN)'. 

The report can be found in this [link](https://essay.utwente.nl/102063/). 

## SE-LCN Architecture
![Alt text](extra\Encoder.png)

Since this is a cascaded MTL approach, each network will be trained separately and the results generated by one network would be used to aid the training and inference of the next network. 

In all the scripts, modify the dataset and model paths according to your own directory structure.

## Training
### Segmentation Network
In order to find the optimal hyperparameters for the segmentation network, run [train_seg_hp.py](train_seg_hp.py)

Then, using the optimal hyperparameters train the segmentation network using [train_seg.py](train_seg.py)

Evaluate the performance of the segmentation network using [test_seg.py](test_seg.py)

In order to generate segmentation masks for an entire dataset, run [run_seg.py](run_seg.py)
Edit the paths and uncomment the required functions depending on the type of mask you want to generate (segmentation, LAE, binary). 


### Symmetry Classification Network
In order to find the optimal hyperparameters for the segmentation network, run [train_symmetry_hp.py](train_symmetry_hp.py). 
Mention the type of input masking in the arguments. 
Example usage, 
```bash
python train_symmetry_hp.py --mask 'Segmentation' 
```

To train the symmetry classification model using the optimal hyperparameters and cross-validation approach, run [train_symmetry_cv.py](train_symmetry_cv.py)
Mention the model name, type of masking and number of cross-validation folds. Edit the script to include the optimal hyperparameters.
Example usage, 
```bash
python train_symmetry_cv.py --model_name 'symmetry_net' --mask 'Segmentation' --n_splits 3 
```

To evaluate the CAMs that would be generated by the symmetry classification network, run [evaluate_cam.py](evaluate_cam.py). 
Make sure to add 'symmetry' to the argument --network
Example usage, 
```bash
python evaluate_cam.py --network 'symmetry' --mask 'Segmentation' 
```

To generate CAMs of an entire dataset using the symmetry classification model, run [generate_cam.py](generate_cam.py).
Example usage, 
```bash
python generate_cam.py --mask 'Segmentation' 
```

### Skin Lesion Classification Network
In order to find the optimal hyperparameters for a standalone classification network (without CAM transfer), run [train_classifier_hp.py](train_classifier_hp.py).
Example usage, 
```bash
python train_classifier_hp.py --mask 'Segmentation' 
```

To train a standalone lesion classification network (without CAM transfer) using the optimal hyperparameters and CV approach, run [train_classifier_cv.py](train_classifier_cv.py)
Mention the model name, type of masking and number of cross-validation folds. Edit the script to include the optimal hyperparameters.
Example usage, 
```bash
python train_classifier_cv.py --model_name 'classifier' --mask 'Segmentation' --n_splits 4 
```

To evaluate the CAMs generated by the standalone lesion classification network (without CAM transfer), run [evaluate_cam.py](evaluate_cam.py). 
Make sure to add 'classification' to the argument --network
Example usage, 
```bash
python evaluate_cam.py --network 'classification' --mask 'Segmentation' 
```

In order to find the optimal hyperparameters for the final SE-LCN network (with CAM transfer), run [train_classifier_final_hp.py](train_classifier_final_hp.py).
Mention the type of masking that is used in both lesion classification network and symmetry classification network
Example usage, 
```bash
python train_classifier_final_hp.py --mask 'Segmentation' --cam_mask 'Segmentation'
```

To train the final SE-LCN network (with CAM transfer) using the optimal hyperparameters and CV approach, run [train_classifier_final_cv.py](train_classifier_final_cv.py)
Mention the model name, type of masking (for both networks) and number of cross-validation folds. Edit the script to include the optimal hyperparameters.
Example usage, 
```bash
python train_classifier_final_cv.py --model_name 'classifier' --mask 'Segmentation' --cam_mask 'Segmentation' --n_splits 4 
```

To evaluate the CAMs generated by the final SE-LCN network (with CAM transfer), run [evaluate_cam_final.py](evaluate_cam_final.py). 
Example usage, 
```bash
python evaluate_cam_final.py - --mask 'Segmentation' --cam_mask 'Segmentation'
```

### Extra
The directory [utils](utils\) contains additional scripts for balancing datasets and implementing train/test splits. 